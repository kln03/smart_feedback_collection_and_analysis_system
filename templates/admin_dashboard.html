<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Smart Feedback Analyzer</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- WordCloud2.js Library -->
<script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        @keyframes slideIn { from {opacity: 0; transform: translateY(30px);} to {opacity: 1; transform: translateY(0);} }
        .animated-card { animation: slideIn 0.8s ease-out forwards; opacity: 0; }
        th { background-color: theme('colors.blue.600') !important; color: white !important; }
        .chart-card { background: white; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    </style>
</head>

<body class="bg-gray-50 flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="text-2xl font-extrabold text-gray-800"><span class="text-blue-600">Smart</span> Analyzer (Admin)</div>
            <nav class="hidden md:flex space-x-4">
                <a href="/admin_dashboard" class="text-blue-600 font-semibold px-3 py-2 rounded-lg bg-blue-50/50">Dashboard</a>
                <a href="{% url 'logout' %}" class="border border-red-500 text-red-500 px-4 py-2 rounded-full font-medium hover:bg-red-50 transition">Logout</a>
            </nav>
        </div>


        
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden p-2 text-gray-600 hover:text-blue-600 rounded-lg hover:bg-gray-100 transition duration-150">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
        
        <!-- Mobile Menu Drawer -->
        <nav id="mobile-menu" class="hidden md:hidden px-4 pt-2 pb-4 space-y-1 bg-gray-50 border-t border-gray-200 transition-all duration-300 ease-in-out">
            <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-blue-600 bg-blue-100/50">Dashboard</a>
            <a href="{% url 'aboutus' %}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-200">About Us</a>
            <a href="{% url 'logout' %}" class="block w-full px-3 py-2 rounded-full text-base font-medium text-red-500 border border-red-500 text-center hover:bg-red-50 mt-2">Logout</a>
        </nav>

    </header>

    <!-- Main -->
    <main class="max-w-7xl mx-auto py-12 px-4 flex-grow">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-4">Administrator Overview</h1>
        <p class="text-gray-500 mb-10">Review, manage, and visualize all feedback across the platform.</p>

        <!-- Feedback Count -->

        <section class="bg-white p-8 rounded-2xl shadow-2xl mb-12">
  <h2 class="text-xl font-semibold text-gray-700 mb-4">Total Feedback Received</h2>
  <p class="text-6xl font-extrabold text-blue-600 mb-6">{{ total_feedback }}</p>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-blue-50 p-4 rounded-xl shadow-sm text-center">
      <h3 class="text-lg font-medium text-green-600 mb-2">Positive Feedback</h3>
      <p class="text-4xl font-bold text-green-700">{{ positive }}</p>
    </div>

    <div class="bg-red-50 p-4 rounded-xl shadow-sm text-center">
      <h3 class="text-lg font-medium text-red-600 mb-2">Negative Feedback</h3>
      <p class="text-4xl font-bold text-red-700">{{ negative }}</p>
    </div>

    <div class="bg-gray-50 p-4 rounded-xl shadow-sm text-center">
      <h3 class="text-lg font-medium text-gray-600 mb-2">Neutral Feedback</h3>
      <p class="text-4xl font-bold text-gray-700">{{ neutral }}</p>
    </div>
  </div>
</section>
        
        <!-- Feedback Table -->
        <section class="bg-white p-6 rounded-xl shadow-2xl mb-12">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-blue-600">All System Feedback</h2>
                <select id="sentiment-filter" class="p-2 border rounded-lg" onchange="filterFeedback()">
                    <option value="All">All Sentiments</option>
                    <option value="Positive">Positive</option>
                    <option value="Negative">Negative</option>
                    <option value="Neutral">Neutral</option>
                </select>
            </div>

            <div class="overflow-x-auto border rounded-lg">
                <table id="feedback-table" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-blue-600 text-white">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase">Feedback</th>
                            <th class="px-6 py-3 text-center text-xs font-medium uppercase">Expression</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase">Sentiment</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase">Score</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase">Date</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider rounded-tr-lg">Action</th>
    
                     
                        </tr>
                    </thead>
                    <tbody id="feedback-table-body" class="bg-white divide-y divide-gray-200">
                        {% for f in feedbacks %}
                        <tr data-sentiment="{{ f.sentiment_label|title }}" class="hover:bg-gray-50">
                            <td class="px-6 py-4 text-sm text-gray-900">{{ f.feedback_text }}</td>
                            <td class="px-6 py-4 text-center text-lg">
                                {% if f.sentiment_label|title == 'Positive' %}üòä{% elif f.sentiment_label|title == 'Negative' %}üò°{% else %}üòê{% endif %}
                            </td>
                            <td class="px-6 py-4 text-sm font-semibold {% if f.sentiment_label|title == 'Positive' %}text-green-600{% elif f.sentiment_label|title == 'Negative' %}text-red-600{% else %}text-yellow-600{% endif %}">
                                {{ f.sentiment_label|title }}
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-600">{{ f.sentiment_score|floatformat:2 }}</td>
                            <td class="px-6 py-4 text-sm text-gray-500">{{ f.created_at }}</td>
                       <td class="px-6 py-4 whitespace-nowrap text-sm">
    <a href="{% url 'delete_feedback' f.feedback_id %}"
       class="inline-flex items-center px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition duration-150"
       onclick="return confirm('Are you sure you want to delete this feedback?');">
        <!-- Trash Icon (Heroicons) -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        Delete
    </a>
</td>
                       
                       
                        </tr>
                        {% empty %}
                        <tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No feedback available.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
<!-- DOWNLOAD FEEDBACK DATA SECTION -->
<div class="bg-white p-6 rounded-xl shadow-lg mb-8">
    <h3 class="text-xl font-semibold text-blue-600 mb-4">Export Feedback Records</h3>

    <form action="{% url 'download_feedbacks' 'xlsx' %}" method="get" class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 space-y-3 sm:space-y-0">
        <div class="flex flex-col">
            <label for="start_date" class="text-gray-600 text-sm font-medium mb-1">From Date</label>
            <input type="date" id="start_date" name="start_date" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-200">
        </div>
        <div class="flex flex-col">
            <label for="end_date" class="text-gray-600 text-sm font-medium mb-1">To Date</label>
            <input type="date" id="end_date" name="end_date" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-200">
        </div>

        <div class="flex space-x-3 mt-3 sm:mt-5">
            <button formaction="{% url 'download_feedbacks' 'csv' %}" 
                    class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition">
                Download as CSV
            </button>
            <button formaction="{% url 'download_feedbacks' 'xlsx' %}" 
                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition">
                Download as Excel
            </button>
        </div>
    </form>

    <p class="text-gray-500 text-sm mt-3">Select a date range (optional). Leave blank to download all feedbacks.</p>
</div>

        <!-- 8 Visualization Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Pie Chart -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Sentiment Distribution (Pie)</h3><canvas id="pieChart"></canvas></div>

            <!-- Doughnut Chart -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Sentiment Ratio (Doughnut)</h3><canvas id="doughnutChart"></canvas></div>

            <!-- Bar Chart -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Feedback Count per Sentiment (Bar)</h3><canvas id="barChart"></canvas></div>

            <!-- Horizontal Bar -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Feedback Frequency (Horizontal Bar)</h3><canvas id="horizontalBarChart"></canvas></div>

            <!-- Line Chart -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Sentiment Trend Over Time (Line)</h3><canvas id="lineChart"></canvas></div>

            <!-- Radar Chart -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Sentiment Intensity (Radar)</h3><canvas id="radarChart"></canvas></div>

            <!-- Polar Chart -->
            <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Overall Sentiment Spread (Polar Area)</h3><canvas id="polarChart"></canvas></div>

            <!-- Bubble Chart -->
           
           
         <div class="chart-card"><h3 class="text-xl font-semibold mb-2 text-blue-600">Score vs Sentiment Volume (Bubble)</h3><canvas id="bubbleChart"></canvas></div>
       <div class="chart-card">
    <h3 class="text-xl font-semibold mb-2 text-blue-600">Sentiment Distribution Over Time (Stacked Area)</h3>
    <canvas id="stackedAreaChart"></canvas>
</div>



<div class="chart-card text-center">
    <h3 class="text-xl font-semibold mb-2 text-blue-600">Overall Satisfaction Level</h3>
    <canvas id="gaugeChart" width="250" height="250"></canvas>
    <p class="mt-4 text-lg font-medium text-gray-600">Score: {{ satisfaction_score|floatformat:1 }}%</p>
</div>


<!-- WORD CLOUD VISUALIZATION -->
<div class="chart-card text-center">
    <h3 class="text-xl font-semibold mb-4 text-blue-600">Most Frequent Words in Feedback</h3>
    <div id="wordCloudContainer" class="mx-auto" style="width: 100%; height: 400px;"></div>
    <p class="text-sm text-gray-500 mt-2">Larger words represent higher frequency in feedback content.</p>
</div>
<!-- SCATTER PLOT VISUALIZATION -->
<div class="chart-card text-center">
    <h3 class="text-xl font-semibold mb-4 text-blue-600">Sentiment Score Distribution (Scatter Plot)</h3>
    <canvas id="scatterPlot" height="400"></canvas>
    <p class="text-sm text-gray-500 mt-2">Each dot represents a feedback‚Äôs sentiment score.</p>
</div>

       

<!-- AVERAGE RATING PER CATEGORY -->
<div class="chart-card">
  <h3 class="text-xl font-semibold mb-2 text-blue-600">Average Rating per Product Category</h3>
  <canvas id="categoryRatingChart"></canvas>
  <p class="text-sm text-gray-500 mt-2">Shows average star rating per category (1‚Äì5 scale).</p>
</div>

<!-- CATEGORY-WISE SENTIMENT BREAKDOWN -->
<div class="chart-card">
  <h3 class="text-xl font-semibold mb-2 text-blue-600">Category-wise Sentiment Breakdown</h3>
  <canvas id="categorySentimentChart"></canvas>
  <p class="text-sm text-gray-500 mt-2">Compares sentiment distribution across product categories.</p>
</div>


        </div>
    </main>

    <footer class="bg-gray-800 text-white p-6 mt-12 text-center text-sm">&copy; 2025 Smart Feedback System. All rights reserved.</footer>

    <!-- Chart.js Script -->
    <script>


         document.addEventListener('DOMContentLoaded', () => {
            // --- Mobile Menu Toggle Logic ---
            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            if (button && menu) {
                button.addEventListener('click', () => {
                    // Toggle the 'hidden' class to show/hide the menu
                    menu.classList.toggle('hidden');
                });
            }
        });



        
        const labels = {{ chart_labels|safe }};
        const data = {{ chart_data|safe }};
        const trendDates = {{ trend_dates|safe }};
        const pos = {{ positive_trends|safe }};
        const neg = {{ negative_trends|safe }};
        const neu = {{ neutral_trends|safe }};

        // Reusable colors
        const colors = ['#22c55e', '#ef4444', '#eab308'];

        // PIE
        new Chart(document.getElementById('pieChart'), { type: 'pie', data: { labels, datasets: [{ data, backgroundColor: colors }] } });

        // DOUGHNUT
        new Chart(document.getElementById('doughnutChart'), { type: 'doughnut', data: { labels, datasets: [{ data, backgroundColor: colors }] } });

        // BAR
        new Chart(document.getElementById('barChart'), { type: 'bar', data: { labels, datasets: [{ data, backgroundColor: colors }] }, options: { scales: { y: { beginAtZero: true } } } });

        // HORIZONTAL BAR
        new Chart(document.getElementById('horizontalBarChart'), { type: 'bar', data: { labels, datasets: [{ data, backgroundColor: colors }] }, options: { indexAxis: 'y', scales: { x: { beginAtZero: true } } } });

        // LINE
        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: trendDates,
                datasets: [
                    { label: 'Positive', data: pos, borderColor: colors[0], backgroundColor: colors[0]+'33', fill: true },
                    { label: 'Negative', data: neg, borderColor: colors[1], backgroundColor: colors[1]+'33', fill: true },
                    { label: 'Neutral', data: neu, borderColor: colors[2], backgroundColor: colors[2]+'33', fill: true },
                ]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });

        // RADAR
        new Chart(document.getElementById('radarChart'), { type: 'radar', data: { labels, datasets: [{ data, backgroundColor: 'rgba(59,130,246,0.2)', borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6' }] } });

        // POLAR
        new Chart(document.getElementById('polarChart'), { type: 'polarArea', data: { labels, datasets: [{ data, backgroundColor: colors }] } });

        // BUBBLE
        new Chart(document.getElementById('bubbleChart'), {
            type: 'bubble',
            data: { datasets: [
                { label: 'Positive', data: [{x:1, y:data[0], r:data[0]*2}], backgroundColor: colors[0] },
                { label: 'Negative', data: [{x:2, y:data[1], r:data[1]*2}], backgroundColor: colors[1] },
                { label: 'Neutral',  data: [{x:3, y:data[2], r:data[2]*2}], backgroundColor: colors[2] },
            ]},
            options: { scales: { x: { beginAtZero:true }, y: { beginAtZero:true } } }
        });


        // STACKED AREA CHART
new Chart(document.getElementById('stackedAreaChart'), {
    type: 'line',
    data: {
        labels: {{ trend_dates|safe }},
        datasets: [
            { label: 'Positive', data: {{ positive_trends|safe }}, borderColor: '#22c55e', backgroundColor: '#22c55e55', fill: true, stack: 'sentiments' },
            { label: 'Negative', data: {{ negative_trends|safe }}, borderColor: '#ef4444', backgroundColor: '#ef444455', fill: true, stack: 'sentiments' },
            { label: 'Neutral',  data: {{ neutral_trends|safe }},  borderColor: '#eab308', backgroundColor: '#eab30855', fill: true, stack: 'sentiments' },
        ]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Feedback Count' } },
            x: { title: { display: true, text: 'Date' } }
        },
        plugins: { legend: { position: 'top' } }
    }
});


// GAUGE CHART (CIRCULAR METER)
const gaugeValue = {{ satisfaction_score|floatformat:1 }};
const ctxGauge = document.getElementById('gaugeChart').getContext('2d');

new Chart(ctxGauge, {
    type: 'doughnut',
    data: {
        datasets: [{
            data: [gaugeValue, 100 - gaugeValue],
            backgroundColor: [
                gaugeValue >= 70 ? '#22c55e' : gaugeValue >= 40 ? '#eab308' : '#ef4444',
                '#e5e7eb'
            ],
            borderWidth: 0,
            cutout: '75%',
            rotation: -90,
            circumference: 180
        }]
    },
    options: {
        responsive: true,
        plugins: {
            tooltip: { enabled: false },
            legend: { display: false },
        }
    }
});


// WORD CLOUD INITIALIZATION
document.addEventListener('DOMContentLoaded', () => {
    const wordData = {{ wordcloud_data|safe }};
    if (wordData.length > 0) {
        WordCloud(document.getElementById('wordCloudContainer'), {
            list: wordData,
            gridSize: 12,
            weightFactor: 12,
            fontFamily: 'Inter, sans-serif',
            color: (word) => {
                const palette = ['#3b82f6', '#22c55e', '#ef4444', '#eab308', '#8b5cf6'];
                return palette[Math.floor(Math.random() * palette.length)];
            },
            rotateRatio: 0.5,
            rotationSteps: 2,
            backgroundColor: '#f9fafb',
            shuffle: true,
            drawOutOfBound: false,
        });
    } else {
        document.getElementById('wordCloudContainer').innerHTML = "<p class='text-gray-400 mt-20'>No feedback data yet to generate word cloud.</p>";
    }
});


// SCATTER PLOT VISUALIZATION
const scatterPoints = {{ scatter_data|safe }};

// Prepare datasets grouped by sentiment
const positivePoints = scatterPoints.filter(p => p.label === 'Positive');
const negativePoints = scatterPoints.filter(p => p.label === 'Negative');
const neutralPoints = scatterPoints.filter(p => p.label === 'Neutral');

new Chart(document.getElementById('scatterPlot'), {
    type: 'scatter',
    data: {
        datasets: [
            {
                label: 'Positive Feedbacks',
                data: positivePoints,
                backgroundColor: '#22c55e',
                pointRadius: 6,
            },
            {
                label: 'Negative Feedbacks',
                data: negativePoints,
                backgroundColor: '#ef4444',
                pointRadius: 6,
            },
            {
                label: 'Neutral Feedbacks',
                data: neutralPoints,
                backgroundColor: '#eab308',
                pointRadius: 6,
            },
        ],
    },
    options: {
        responsive: true,
        scales: {
            x: {
                title: { display: true, text: 'Feedback Index' },
                grid: { display: false },
            },
            y: {
                title: { display: true, text: 'Sentiment Score (-1 to +1)' },
                min: -2,
                max: 2,
                ticks: { stepSize: 0.2 },
            },
        },
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: {
                    label: (context) => {
                        return `${context.dataset.label}: ${context.parsed.y}`;
                    }
                }
            }
        }
    }
});




// CATEGORY-WISE AVERAGE RATINGS
const catLabels = {{ category_labels|safe }};
const avgRatings = {{ avg_ratings|safe }};
new Chart(document.getElementById('categoryRatingChart'), {
    type: 'bar',
    data: {
        labels: catLabels,
        datasets: [{
            label: 'Average Rating',
            data: avgRatings,
            backgroundColor: '#3b82f6'
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true, max: 5, title: { display: true, text: 'Rating (1‚Äì5)' } },
            x: { title: { display: true, text: 'Category' } }
        }
    }
});

// CATEGORY-WISE SENTIMENT COMPARISON
const catPos = {{ cat_pos|safe }};
const catNeg = {{ cat_neg|safe }};
const catNeu = {{ cat_neu|safe }};

new Chart(document.getElementById('categorySentimentChart'), {
    type: 'bar',
    data: {
        labels: catLabels,
        datasets: [
            { label: 'Positive', data: catPos, backgroundColor: '#22c55e' },
            { label: 'Negative', data: catNeg, backgroundColor: '#ef4444' },
            { label: 'Neutral', data: catNeu, backgroundColor: '#eab308' },
        ]
    },
    options: {
        responsive: true,
        plugins: { legend: { position: 'top' } },
        scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Feedback Count' } },
            x: { stacked: true, title: { display: true, text: 'Category' } },
        }
    }
});



        // Filter function
        function filterFeedback() {
            const selected = document.getElementById('sentiment-filter').value;
            const rows = document.querySelectorAll('#feedback-table-body tr');
            rows.forEach(r => {
                const sentiment = r.getAttribute('data-sentiment');
                r.style.display = (selected === 'All' || selected === sentiment) ? '' : 'none';
            });
        }
    </script>
</body>
</html>
